<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>موقع أهل الخير النسوية</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @keyframes zoomOut {
  from {
    transform: scale(1.2);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.vertical-form {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  max-width: 400px;
  margin: auto;
  margin-top: 20px;
  background-color: #ffffff;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  animation: zoomOut 0.4s ease;
  position: relative;
  z-index: 10;
}

    
    .vertical-form {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  max-width: 400px;
  margin: auto;
  background-color: #ffffff;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.vertical-form input,
.vertical-form select,
.vertical-form button {
  width: 100%;
  margin-bottom: 15px;
  font-size: 16px;
}

    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(to bottom, #e0ffe6, #a8e6cf);
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #fffffffa;
      color: #004d26;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo-small {
      height: 50px;
      margin-left: 10px;
      border-radius: 8px;
      border: 2px solid white;
    }
    .login-container, .container, .user-view {
      padding: 20px;
      text-align: center;
    }
    .login-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .login-box {
      background-color: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      text-align: center;
      width: 300px;
    }
    .login-box input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    .password-wrapper {
      position: relative;
      width: 100%;
    }
    .password-wrapper i {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #888;
    }
    button, .buttons a {
      padding: 10px 20px;
      background-color: #005522;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .announcement-box, .edit-section {
      margin: 20px auto;
      max-width: 600px;
      background: #94fa7b;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      text-align: right;
    }
    .edit-header {
      display: flex;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .edit-header i {
      margin-left: 10px;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-size: 16px;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .announcements div {
      background-color: #d4f5dc;
      margin: 10px auto;
      padding: 15px;
      border-radius: 8px;
      max-width: 600px;
      font-size: 17px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .announcements div button {
      background: none;
      border: none;
      color: red;
      font-size: 18px;
      cursor: pointer;
    }
    .user-view {
      display: none;
    }
    .announcement {
      background-color: #d4f5dc;
      margin: 20px auto;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-size: 18px;
      font-weight: bold;
      color: #003311;
      text-align: center;
    }
    .logo-container img {
      border: 4px solid #004d26;
      border-radius: 12px;
      max-width: 250px;
      height: auto;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 40px;
      gap: 15px;
    }
    .buttons a {
      background: linear-gradient(to right, #007bff, #0056b3);
      color: white;
      padding: 14px 24px;
      border-radius: 10px;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .buttons a:hover {
      background: linear-gradient(to right, #ff3333, #3db84d);
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(255, 0, 212, 0.2);
    }
    #kafalaPage {
      display: none;
      padding: 20px;
      text-align: right;
    }
    #kafalaPage input, #kafalaPage select {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px auto;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    footer {
      margin-top: 60px;
      background-color: #3fdd8e;
      color: white;
      text-align: center;
      padding: 15px 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- واجهة مشرفة الحرف -->
<div id="letterSupervisorPanel" style="display:none; padding: 20px; text-align:right;">
  <h2 id="letterWelcome">مرحباً، مشرفة الحرف</h2>
  <div id="letterKafalaList">جاري تحميل الكفالات...</div>
  <br>
  <button onclick="logoutLetterSupervisor()" style="background-color: gray;">تسجيل خروج</button>
</div>

<!-- صفحة قسم التحقق -->
<div id="verifySection" style="display:none; padding: 20px; text-align:right;">
  <h2>قسم التحقق من مشرفات الحروف</h2>
  <div id="pendingRequests" style="background:#fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
    جاري تحميل الطلبات...
  </div>
  <div style="margin-top: 30px;" class="edit-section">
    <h3>تعديل بيانات الدخول لقسم التحقق</h3>
    <input id="verifyNewUser" placeholder="اسم المستخدم الجديد">
    <input id="verifyNewPass" type="password" placeholder="كلمة المرور الجديدة">
    <button onclick="updateVerifyLogin()">تحديث البيانات</button>
  </div>
</div>


<div class="login-container" id="loginSection">
  <img src="https://i.imgur.com/WgyltwP.jpeg" alt="شعار المنظمة" style="border-radius: 8px; border: 3px solid #004d26;" width="251">
  <div class="login-box">
    <h2>تسجيل الدخول</h2>
    <input type="text" id="username" placeholder="اسم المستخدم">
    <div class="password-wrapper">
      <input type="password" id="password" placeholder="كلمة المرور">
      <i class="fa fa-eye" onclick="togglePassword()"></i>
    </div>
    <button onclick="login()">دخول</button>
    <br><br>
    <button onclick="showUserView()">دخول كمستخدم</button>
    <br><br>
<button onclick="showLetterSupervisorForm()">أنا مشرفة حرف</button>


  </div>
</div>
<div id="letterSupervisorForm" class="vertical-form" style="display:none;">
  <img src="https://i.imgur.com/WgyltwP.jpeg" alt="شعار المنظمة" style="width: 120px; border-radius: 8px; border: 3px solid #004d26; margin: auto; display: block; margin-bottom: 15px;">
  <h2 style="text-align: center; margin-bottom: 20px;">تسجيل مشرفة حرف</h2>

  <input id="letterSupervisor_username" placeholder="اسم المستخدم">
  <input id="letterSupervisor_password" type="password" placeholder="كلمة المرور">
  
  <select id="letterSupervisor_letter">
    <option disabled selected>اختر الحرف المشرفة عليه</option>
    <option value="أ">أ</option>
    <option value="ب">ب</option>
    <option value="ت">ت</option>
    <option value="ث">ث</option>
    <option value="ج">ج</option>
    <option value="ح">ح</option>
    <option value="خ">خ</option>
    <option value="د">د</option>
    <option value="ذ">ذ</option>
    <option value="ر">ر</option>
    <option value="ز">ز</option>
    <option value="س">س</option>
    <option value="ش">ش</option>
    <option value="ص">ص</option>
    <option value="ض">ض</option>
    <option value="ط">ط</option>
    <option value="ظ">ظ</option>
    <option value="ع">ع</option>
    <option value="غ">غ</option>
    <option value="ف">ف</option>
    <option value="ق">ق</option>
    <option value="ك">ك</option>
    <option value="ل">ل</option>
    <option value="م">م</option>
    <option value="ن">ن</option>
    <option value="هـ">هـ</option>
    <option value="و">و</option>
    <option value="ي">ي</option>
  </select>

  <select id="letterSupervisor_gender">
    <option disabled selected>مشرفة على:</option>
    <option value="رجال">رجال</option>
    <option value="نساء">نساء</option>
  </select>

  <button onclick="submitLetterSupervisor()">إرسال</button>
  <button onclick="backToLogin()" style="background-color: rgb(131, 5, 5);">رجوع</button>
</div>





<!-- قسم الإعلام -->
<div style="display:none;" id="adminPanel">
  <header>قسم الإعلام <img src="https://i.imgur.com/WgyltwP.jpeg" class="logo-small"></header>
  <div class="container">
    <div class="announcement-box">
      <h2>الإعلانات</h2>
      <textarea id="newAnnouncement" placeholder="اكتب الإعلان هنا..."></textarea><br>
      <button onclick="addAnnouncement()">إضافة الإعلان</button>
      <p id="limitMsg" style="color: red; font-weight: bold;"></p>
    </div>
    <div class="announcements" id="announcementList"></div>
    <div class="edit-section">
      <div class="edit-header"><i class="fa fa-user"></i><i class="fa fa-cog"></i> تغيير بيانات الدخول</div>
      <input type="text" id="newUsername" placeholder="اسم المستخدم الجديد">
      <input type="password" id="newPassword" placeholder="كلمة المرور الجديدة">
      <button onclick="updateLogin()">تحديث البيانات</button>
    </div>
  </div>
</div>

<!-- صفحة المستخدم -->
<div class="user-view" id="userPanel">
  <header>منظمة أهل الخير النسوية</header>
  <div class="announcement" id="userAnnouncements">جاري تحميل الإعلانات...</div>
  <div class="logo-container">
    <img src="https://i.imgur.com/WgyltwP.jpeg" alt="شعار المنظمة">
  </div>
  <div class="buttons">
    <a href="https://www.tiktok.com/@ahlalkheir1" target="_blank">تيك توك</a>
    <a href="https://www.facebook.com/ahl.alkhir.3" target="_blank">فيسبوك</a>
    <a href="https://www.chatbase.co/chatbot-iframe/BkJ7ITdQa_AlVr3tZsXqB" target="_blank">الذكاء الصناعي</a>
    <a href="https://wa.me/+249123161564" target="_blank">اتصل بنا</a>
    <a onclick="goToKafalaPage()" style="cursor:pointer;">كفالة يتيم</a>
  </div>
</div>

<!-- استمارة كفالة اليتيم -->
<div id="kafalaPage">
  <h2>استمارة كفالة يتيم</h2>
  <input id="kafala_name" placeholder="اسم الكفيل">
  <input id="kafala_email" placeholder="البريد الإلكتروني">
  <input id="kafala_phone" placeholder="رقم الهاتف">
  <input id="kafala_phone2" placeholder="رقم الهاتف الاحتياطي">
  <input id="kafala_job" placeholder="الوظيفة">
  <input id="kafala_degree" placeholder="الدرجة العلمية">
  <input id="kafala_time" placeholder=" تاريخ النضمام">
  <select id="kafala_orphans">
    <option enabel selected>عدد الأيتام</option>
  </select>
  <select id="kafala_period">
    <option disabled selected>مدة الكفالة</option>
    <option>شهر</option>
    <option>سنة</option>
    <option>أكثر من سنة</option>
  </select>
  <button onclick="submitKafala()">إرسال</button>
  <button onclick="backToUser()" style="background-color: rgb(173, 18, 18);">رجوع</button>
  <h2><strong>ملاحظة:</strong> توجد التزامات مثل كرتونة رمضان وفرحة العيدين</h2>
  <h2> الرجاء اخطارنا قبل شهر في حالة الغاء الكفاله</h2>
</div>

<footer>&copy; 2025 منظمة أهل الخير النسوية</footer>

<script>
  function loadFormsForSupervisor(letter, gender) {
  const all = JSON.parse(localStorage.getItem("submissions") || "{}");
  const list = all[`${letter}-${gender}`] || [];

  const container = document.getElementById("staffForms");
  container.innerHTML = "";

  if (list.length === 0) {
    container.innerHTML = "لا توجد استمارات حالياً.";
    return;
  }

  list.forEach((data, index) => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ccc";
    div.style.padding = "10px";
    div.innerHTML = `
      <strong>${index + 1} - ${data.name}</strong><br>
      📧 ${data.email}<br>
      ☎️ ${data.phone}<br>
      💼 ${data.job} - 🎓 ${data.degree}<br>
      👶 عدد الأيتام: ${data.orphans} - المدة: ${data.period}
    `;
    container.appendChild(div);
  });
}

  function submitLetterSupervisor() {
  const username = document.getElementById("letterSupervisor_username").value.trim();
  const password = document.getElementById("letterSupervisor_password").value.trim();
  const letter = document.getElementById("letterSupervisor_letter").value;
  const gender = document.getElementById("letterSupervisor_gender").value;

  if (!username || !password || !letter || !gender) {
    alert("يرجى تعبئة جميع الحقول.");
    return;
  }

  const newData = {
    username,
    password,
    letter,
    gender,
    verified: false // لسه محتاجة موافقة من قسم التحقق
  };

  // جلب البيانات القديمة
  let supervisors = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  supervisors.push(newData);
  localStorage.setItem("letterSupervisors", JSON.stringify(supervisors));

  alert("✅ تم إرسال البيانات بنجاح، في انتظار التحقق.");
  backToLogin();
}

  
function approveSupervisor(index) {
  const requests = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  const approved = requests.splice(index, 1)[0];
  approved.verified = true;

  // تأكد التخزين يكون object
  let approvedAccounts = JSON.parse(localStorage.getItem("verifiedSupervisors") || "{}");
  approvedAccounts[approved.username] = {
    password: approved.password,
    letter: approved.letter,
    gender: approved.gender
  };

  localStorage.setItem("verifiedSupervisors", JSON.stringify(approvedAccounts));
  localStorage.setItem("letterSupervisors", JSON.stringify(requests));
  loadVerificationRequests();
  alert("✅ تم قبول المشرفة");
}

function rejectSupervisor(index) {
  let all = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  all.splice(index, 1);
  localStorage.setItem("letterSupervisors", JSON.stringify(all));
  loadVerificationRequests();
  alert("❌ تم رفض الطلب وحذفه");
}

  function loadVerificationRequests() {
  const container = document.getElementById("pendingRequests");
  const all = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  const pending = all.filter(e => !e.verified);

  if (pending.length === 0) {
    container.innerHTML = "لا توجد طلبات معلقة حالياً.";
    return;
  }

  container.innerHTML = "";
  pending.forEach((req, i) => {
    const div = document.createElement("div");
    div.style.border = "1px solid #ccc";
    div.style.padding = "10px";
    div.style.marginBottom = "10px";
    div.style.borderRadius = "8px";
    div.style.background = "#fff";

    div.innerHTML = `
      <strong>${req.username}</strong> - الحرف: ${req.letter} - ${req.gender}<br>
      <button onclick="approveSupervisor(${i})">✅ أوافق</button>
      <button onclick="rejectSupervisor(${i})" style="background-color: red;">❌ رفض</button>
    `;
    container.appendChild(div);
  });
}

  function updateVerifyLogin() {
  const user = document.getElementById("verifyNewUser").value.trim();
  const pass = document.getElementById("verifyNewPass").value.trim();
  if (user && pass) {
    localStorage.setItem("verify_user", user);
    localStorage.setItem("verify_pass", pass);
    alert("✅ تم تحديث بيانات الدخول لقسم التحقق");
  } else {
    alert("❌ يرجى تعبئة الحقول أولاً");
  }
}

  // بيانات دخول قسم التحقق
if (!localStorage.getItem("verify_user")) {
  localStorage.setItem("verify_user", "verify");
  localStorage.setItem("verify_pass", "9999");
}

function showVerifyLogin() {
  const user = prompt("ادخل اسم المستخدم لقسم التحقق:");
  const pass = prompt("ادخل كلمة المرور:");

  if (user === localStorage.getItem("verify_user") && pass === localStorage.getItem("verify_pass")) {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("verifySection").style.display = "block";
    loadVerificationRequests();
  } else {
    alert("بيانات غير صحيحة");
  }
}

function updateVerifyLogin() {
  const newUser = document.getElementById("verifyNewUser").value.trim();
  const newPass = document.getElementById("verifyNewPass").value.trim();
  if (newUser && newPass) {
    localStorage.setItem("verify_user", newUser);
    localStorage.setItem("verify_pass", newPass);
    alert("✅ تم تحديث بيانات تسجيل الدخول لقسم التحقق.");
  } else {
    alert("يرجى ملء الحقول");
  }
}

function loadVerificationRequests() {
  const container = document.getElementById("pendingRequests");
  const requests = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  if (!requests.length) {
    container.innerHTML = "لا توجد طلبات حالياً.";
    return;
  }

  container.innerHTML = "";
  requests.forEach((req, index) => {
    const box = document.createElement("div");
    box.style.marginBottom = "20px";
    box.style.padding = "15px";
    box.style.border = "1px solid #ccc";
    box.style.borderRadius = "8px";
    box.innerHTML = `
      👤 <strong>${req.username}</strong> | 🔒 ${req.password} <br>
      📝 الحرف: <strong>${req.letter}</strong> - 👥 النوع: <strong>${req.gender}</strong><br><br>
      <button onclick="approveSupervisor(${index})">✅ أوافق</button>
      <button onclick="rejectSupervisor(${index})" style="background:red;">❌ رفض</button>
    `;
    container.appendChild(box);
  });
}

function approveSupervisor(index) {
  const requests = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  const approved = requests.splice(index, 1)[0];
  approved.verified = true;

  let approvedAccounts = JSON.parse(localStorage.getItem("verifiedSupervisors") || "[]");
  approvedAccounts.push(approved);
  localStorage.setItem("verifiedSupervisors", JSON.stringify(approvedAccounts));
  localStorage.setItem("letterSupervisors", JSON.stringify(requests));
  loadVerificationRequests();
  alert("✅ تم قبول المشرفة");
}


function rejectSupervisor(index) {
  const requests = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  requests.splice(index, 1);
  localStorage.setItem("letterSupervisors", JSON.stringify(requests));
  loadVerificationRequests();
  alert("❌ تم رفض الطلب");
}

  function showLetterSupervisorForm() {
  document.getElementById("loginSection").style.display = "none";
  document.getElementById("letterSupervisorForm").style.display = "block";
}

function backToLogin() {
  document.getElementById("letterSupervisorForm").style.display = "none";
  document.getElementById("loginSection").style.display = "flex";
}

function submitLetterSupervisor() {
  const username = document.getElementById("letterSupervisor_username").value.trim();
  const password = document.getElementById("letterSupervisor_password").value.trim();
  const letter = document.getElementById("letterSupervisor_letter").value;
  const gender = document.getElementById("letterSupervisor_gender").value;

  if (!username || !password || !letter || !gender) {
    alert("يرجى تعبئة جميع الحقول.");
    return;
  }

  const newData = {
    username,
    password,
    letter,
    gender,
    verified: false
  };

  // تخزين في LocalStorage مؤقتاً
  let requests = JSON.parse(localStorage.getItem("letterSupervisors") || "[]");
  requests.push(newData);
  localStorage.setItem("letterSupervisors", JSON.stringify(requests));

  alert("✅ تم إرسال البيانات بنجاح، في انتظار التحقق.");
  backToLogin();
}



function loadStaffForms(name) {
  const allData = JSON.parse(localStorage.getItem("submissions") || "{}");
  const list = allData[name] || [];
  const container = document.getElementById("staffForms");

  if (list.length === 0) {
    container.innerHTML = "لا توجد استمارات حالياً.";
    return;
  }

  container.innerHTML = "";
  list.forEach((data, index) => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ccc";
    div.style.padding = "10px";
    div.innerHTML = `
      <strong>${index + 1} - ${data.name}</strong><br>
      📧 ${data.email}<br>
      ☎️ ${data.phone}<br>
      💼 ${data.job} - 🎓 ${data.degree}<br>
      👶 عدد الأيتام: ${data.orphans} - المدة: ${data.period}
    `;
    container.appendChild(div);
  });
}

function searchForms() {
  const term = document.getElementById("searchInput").value.trim();
  if (!term) return loadStaffForms(currentStaff);

  const allData = JSON.parse(localStorage.getItem("submissions") || "{}");
  const list = allData[currentStaff] || [];
  const container = document.getElementById("staffForms");

  const filtered = list.filter(entry => entry.name.includes(term));
  if (filtered.length === 0) {
    container.innerHTML = "لا توجد نتائج مطابقة.";
    return;
  }

  container.innerHTML = "";
  filtered.forEach((data, index) => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ccc";
    div.style.padding = "10px";
    div.innerHTML = `
      <strong>${index + 1} - ${data.name}</strong><br>
      📧 ${data.email}<br>
      ☎️ ${data.phone}<br>
      💼 ${data.job} - 🎓 ${data.degree}<br>
      👶 عدد الأيتام: ${data.orphans} - المدة: ${data.period}
    `;
    container.appendChild(div);
  });
}

function updateStaffLogin() {
  const newUser = document.getElementById("staffNewUsername").value.trim();
  const newPass = document.getElementById("staffNewPassword").value.trim();
  if (newUser && newPass) {
    alert(`تم تحديث اسم المستخدم إلى "${newUser}" وكلمة المرور إلى "${newPass}".\n⚠️ التحديث لا يتم حفظه بعد إعادة تحميل الصفحة.`);
  } else {
    alert("يرجى ملء الحقول أولاً.");
  }
}

  if (!localStorage.getItem("username")) {
    localStorage.setItem("username", "ahlalkhere");
    localStorage.setItem("password", "ahl");
  }

  let announcements = JSON.parse(localStorage.getItem("announcements") || "[]");
  let currentStaff = "";

function showStaffPage(name) {
  currentStaff = name;
  document.getElementById("loginSection").style.display = "none";
  document.getElementById("staffPage").style.display = "block";
  document.getElementById("staffNameTitle").textContent = `قسم ${name}`;
  loadStaffForms(name);
}
function login() {
  const user = document.getElementById("username").value.trim().toLowerCase();
  const pass = document.getElementById("password").value.trim();

  if (user === "admin" && pass === "1234") {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    displayAnnouncements();
    return;
  }
  if (user === localStorage.getItem("verify_user") && pass === localStorage.getItem("verify_pass")) {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("verifySection").style.display = "block";
    loadVerificationRequests();
    return;
  }
  const supervisors = JSON.parse(localStorage.getItem("verifiedSupervisors") || "{}");

if (supervisors[user] && supervisors[user].password === pass) {
  // خلي الصفحة الرئيسية تختفي، وافتح صفحة المشرفة الجديدة
  currentStaff = user;
  document.getElementById("loginSection").style.display = "none";
  document.getElementById("staffPage").style.display = "block";
  document.getElementById("staffNameTitle").textContent = `مشرفة حرف ${supervisors[user].letter} (${supervisors[user].gender})`;

  // تحميل الاستمارات المتوافقة مع الحرف والجنس
  loadFormsForSupervisor(supervisors[user].letter, supervisors[user].gender);
  return;
}

if (!localStorage.getItem("verify_user")) {
  localStorage.setItem("verify_user", "verify");
  localStorage.setItem("verify_pass", "9999");
}
// تحقق من مشرفات الحروف بعد التحقق
let approvedSupervisors = Object.entries(JSON.parse(localStorage.getItem("verifiedSupervisors") || "{}"))
  .map(([username, data]) => ({
    username,
    password: data.password,
    letter: data.letter,
    gender: data.gender
  }));
let supervisor = approvedSupervisors.find(s => s.username === user && s.password === pass);

localStorage.removeItem("verifiedSupervisors"); // مرّة واحدة فقط لمسح التخزين القديم
if (supervisor) {
  // عرض صفحة المشرفة
  currentStaff = supervisor.username;
  currentLetter = supervisor.letter;
  currentGender = supervisor.gender;

  document.getElementById("loginSection").style.display = "none";
  document.getElementById("staffPage").style.display = "block";
  document.getElementById("staffNameTitle").textContent = `مشرفة حرف ${currentLetter} - ${supervisor.username}`;

  // تصفية الكفلاء على حسب الحرف
  loadFilteredKafala(supervisor.letter, supervisor.gender);
  return;
}
let currentStaff = "";
let currentLetter = "";
let currentGender = "";



  const staffLogins = {
    "madihah": { password: "1111", name: "مديحة" },
    "samar": { password: "2222", name: "سمر" },
    "lamia": { password: "3333", name: "لمياء" },
    "hadeel": { password: "4444", name: "هديل" }
  };

  if (staffLogins[user] && staffLogins[user].password === pass) {
    showStaffPage(staffLogins[user].name);
    return;
  }

  alert("بيانات الدخول غير صحيحة");
}
function loadFilteredKafala(letter, gender) {
  const allData = JSON.parse(localStorage.getItem("submissions") || "{}");
  const list = allData[gender] || [];
  const container = document.getElementById("staffForms");

  const filtered = list.filter(data => data.name.startsWith(letter));
  if (filtered.length === 0) {
    container.innerHTML = "لا توجد استمارات بهذا الحرف.";
    return;
  }

  container.innerHTML = "";
  filtered.forEach((data, index) => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ccc";
    div.style.padding = "10px";
    div.innerHTML = `
      <strong>${index + 1} - ${data.name}</strong><br>
      📧 ${data.email}<br>
      ☎️ ${data.phone}<br>
      💼 ${data.job} - 🎓 ${data.degree}<br>
      👶 عدد الأيتام: ${data.orphans} - المدة: ${data.period}
    `;
    container.appendChild(div);
  });
}

  function togglePassword() {
    const pwd = document.getElementById("password");
    pwd.type = pwd.type === "password" ? "text" : "password";
  }

  function showUserView() {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("userPanel").style.display = "block";
    const container = document.getElementById("userAnnouncements");
    container.innerHTML = announcements.length ? "" : "لا توجد إعلانات حالياً.";
    announcements.forEach((text, index) => {
      const el = document.createElement("div");
      el.textContent = `${index + 1} - ${text}`;
      container.appendChild(el);
    });
  }

  function addAnnouncement() {
    const text = document.getElementById("newAnnouncement").value.trim();
    if (!text || announcements.length >= 8) {
      document.getElementById("limitMsg").textContent = "لا يمكن إضافة أكثر من 8 إعلانات في اليوم.";
      return;
    }
    announcements.push(text);
    localStorage.setItem("announcements", JSON.stringify(announcements));
    document.getElementById("newAnnouncement").value = "";
    document.getElementById("limitMsg").textContent = "";
    displayAnnouncements();
  }

  function displayAnnouncements() {
    const list = document.getElementById("announcementList");
    list.innerHTML = "";
    announcements.forEach((text, index) => {
      const item = document.createElement("div");
      item.innerHTML = `${index + 1} - ${text} <button onclick="deleteAnnouncement(${index})"><i class='fa fa-trash'></i></button>`;
      list.appendChild(item);
    });
  }

  function deleteAnnouncement(index) {
    announcements.splice(index, 1);
    localStorage.setItem("announcements", JSON.stringify(announcements));
    displayAnnouncements();
  }

  function updateLogin() {
    const user = document.getElementById("newUsername").value.trim();
    const pass = document.getElementById("newPassword").value.trim();
    if (user && pass) {
      localStorage.setItem("username", user);
      localStorage.setItem("password", pass);
      alert("تم تحديث بيانات الدخول");
    }
  }

const staffAccounts = JSON.parse(localStorage.getItem("submissions")) || {
  "مديحة": [], "سمر": [], "لمياء": [], "هديل": []
};


  function goToKafalaPage() {
    document.getElementById("userPanel").style.display = "none";
    document.getElementById("kafalaPage").style.display = "block";
    const select = document.getElementById("kafala_orphans");
    if (select.options.length <= 1) {
      for (let i = 1; i <= 100; i++) {
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = `${i} يتيم`;
        select.appendChild(opt);
      }
    }
  }

  function backToUser() {
    document.getElementById("kafalaPage").style.display = "none";
    document.getElementById("userPanel").style.display = "block";
  }

  function submitKafala() {
  const newData = {
    name: document.getElementById("kafala_name").value,
    email: document.getElementById("kafala_email").value,
    phone: document.getElementById("kafala_phone").value,
    phone2: document.getElementById("kafala_phone2").value,
    job: document.getElementById("kafala_job").value,
    degree: document.getElementById("kafala_degree").value,
    date: document.getElementById("kafala_time").value,
    orphans: document.getElementById("kafala_orphans").value,
    period: document.getElementById("kafala_period").value,
    gender: document.querySelector('#letterSupervisor_gender')?.value || "غير محدد"
  };

  // جلب البيانات القديمة
  let oldData = JSON.parse(localStorage.getItem("kafalaForms") || "[]");
  oldData.push(newData);

  // تخزين جديد
  localStorage.setItem("kafalaForms", JSON.stringify(oldData));

  alert("✅ تم حفظ استمارة الكفالة بنجاح!");

  // تنظيف الحقول
  document.getElementById("kafala_name").value = "";
  document.getElementById("kafala_email").value = "";
  document.getElementById("kafala_phone").value = "";
  document.getElementById("kafala_phone2").value = "";
  document.getElementById("kafala_job").value = "";
  document.getElementById("kafala_degree").value = "";
  document.getElementById("kafala_time").value = "";
  document.getElementById("kafala_orphans").value = "";
  document.getElementById("kafala_period").value = "";

  backToUser();
}

</script>
<!-- صفحة الموظف -->
<div id="staffPage" style="display:none; padding: 20px;">
  <h2 id="staffNameTitle">قسم الموظف</h2>

  <div style="margin: 20px 0;">
    <input type="text" id="searchInput" placeholder="ابحث عن اسم الكفيل" style="width: 80%; padding: 10px; border-radius: 8px; font-size: 16px;">
    <button onclick="searchForms()">🔍</button>
  </div>

  <div id="staffForms" style="background-color: #f9f9f9; padding: 15px; border-radius: 10px;"></div>

  <div class="edit-section">
    <div class="edit-header"><i class="fa fa-user"></i><i class="fa fa-cog"></i> تغيير بيانات الدخول</div>
    <input type="text" id="staffNewUsername" placeholder="اسم المستخدم الجديد">
    <input type="password" id="staffNewPassword" placeholder="كلمة المرور الجديدة">
    <button onclick="updateStaffLogin()">تحديث البيانات</button>
  </div>
</div>

</body>
</html>